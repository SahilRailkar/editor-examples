!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@tiptap/core")):"function"==typeof define&&define.amd?define(["exports","@tiptap/core"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["@tiptap/extension-bubble-menu"]={},t["@tiptap/core"])}(this,(function(t,e){"use strict";function n(t,e,r){for(var o=0;;o++){if(o==t.childCount||o==e.childCount)return t.childCount==e.childCount?null:r;var i=t.child(o),s=e.child(o);if(i!=s){if(!i.sameMarkup(s))return r;if(i.isText&&i.text!=s.text){for(var a=0;i.text[a]==s.text[a];a++)r++;return r}if(i.content.size||s.content.size){var p=n(i.content,s.content,r+1);if(null!=p)return p}r+=i.nodeSize}else r+=i.nodeSize}}function r(t,e,n,o){for(var i=t.childCount,s=e.childCount;;){if(0==i||0==s)return i==s?null:{a:n,b:o};var a=t.child(--i),p=e.child(--s),c=a.nodeSize;if(a!=p){if(!a.sameMarkup(p))return{a:n,b:o};if(a.isText&&a.text!=p.text){for(var u=0,f=Math.min(a.text.length,p.text.length);u<f&&a.text[a.text.length-u-1]==p.text[p.text.length-u-1];)u++,n--,o--;return{a:n,b:o}}if(a.content.size||p.content.size){var h=r(a.content,p.content,n-1,o-1);if(h)return h}n-=c,o-=c}else n-=c,o-=c}}var o=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},i={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};o.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],p=s+a.nodeSize;if(p>t&&!1!==n(a,r+s,o,i)&&a.content.size){var c=s+1;a.nodesBetween(Math.max(0,t-c),Math.min(a.content.size,e-c),n,r+c)}s=p}},o.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},o.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},o.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),i=1);i<t.content.length;i++)r.push(t.content[i]);return new o(r,this.size+t.size)},o.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var i=0,s=0;s<e;i++){var a=this.content[i],p=s+a.nodeSize;p>t&&((s<t||p>e)&&(a=a.isText?a.cut(Math.max(0,t-s),Math.min(a.text.length,e-s)):a.cut(Math.max(0,t-s-1),Math.min(a.content.size,e-s-1))),n.push(a),r+=a.nodeSize),s=p}return new o(n,r)},o.prototype.cutByIndex=function(t,e){return t==e?o.empty:0==t&&e==this.content.length?this:new o(this.content.slice(t,e))},o.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),i=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new o(r,i)},o.prototype.addToStart=function(t){return new o([t].concat(this.content),this.size+t.nodeSize)},o.prototype.addToEnd=function(t){return new o(this.content.concat(t),this.size+t.nodeSize)},o.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},i.firstChild.get=function(){return this.content.length?this.content[0]:null},i.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},i.childCount.get=function(){return this.content.length},o.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},o.prototype.maybeChild=function(t){return this.content[t]},o.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},o.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),n(this,t,e)},o.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),r(this,t,e,n)},o.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return a(0,t);if(t==this.size)return a(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=r+this.child(n).nodeSize;if(o>=t)return o==t||e>0?a(n+1,o):a(n,r);r=o}},o.prototype.toString=function(){return"<"+this.toStringInner()+">"},o.prototype.toStringInner=function(){return this.content.join(", ")},o.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},o.fromJSON=function(t,e){if(!e)return o.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new o(e.map(t.nodeFromJSON))},o.fromArray=function(t){if(!t.length)return o.empty;for(var e,n=0,r=0;r<t.length;r++){var i=t[r];n+=i.nodeSize,r&&i.isText&&t[r-1].sameMarkup(i)?(e||(e=t.slice(0,r)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new o(e||t,n)},o.from=function(t){if(!t)return o.empty;if(t instanceof o)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new o([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(o.prototype,i);var s={index:0,offset:0};function a(t,e){return s.index=t,s.offset=e,s}function p(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!p(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!p(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}o.empty=new o([],0);var c=function(t,e){this.type=t,this.attrs=e};function u(t){var e=Error.call(this,t);return e.__proto__=u.prototype,e}c.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},c.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},c.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},c.prototype.eq=function(t){return this==t||this.type==t.type&&p(this.attrs,t.attrs)},c.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},c.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},c.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},c.setFrom=function(t){if(!t||0==t.length)return c.none;if(t instanceof c)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},c.none=[],u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u.prototype.name="ReplaceError";var f=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},h={size:{configurable:!0}};function l(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),p=a.index,c=a.offset;if(i==e||s.isText){if(c!=n&&!t.child(p).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=p)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(l(s.content,e-i-1,n-i-1)))}function d(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var p=d(a.content,e-s-1,n);return p&&t.replaceChild(i,a.copy(p))}function m(t,e,n){if(n.openStart>t.depth)throw new u("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new u("Inconsistent open depths");return v(t,e,n,0)}function v(t,e,n,r){var i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){var a=v(t,e,n,r+1);return s.copy(s.content.replaceChild(i,a))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var p=function(t,e){for(var n=e.depth-t.openStart,r=e.node(n).copy(t.content),i=n-1;i>=0;i--)r=e.node(i).copy(o.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t);return x(s,k(t,p.start,p.end,e,r))}var c=t.parent,u=c.content;return x(c,u.cut(0,t.parentOffset).append(n.content).append(u.cut(e.parentOffset)))}return x(s,S(t,e,r))}function y(t,e){if(!e.type.compatibleContent(t.type))throw new u("Cannot join "+e.type.name+" onto "+t.type.name)}function g(t,e,n){var r=t.node(n);return y(r,e.node(n)),r}function b(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function w(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(b(t.nodeAfter,r),i++));for(var a=i;a<s;a++)b(o.child(a),r);e&&e.depth==n&&e.textOffset&&b(e.nodeBefore,r)}function x(t,e){if(!t.type.validContent(e))throw new u("Invalid content for node "+t.type.name);return t.copy(e)}function k(t,e,n,r,i){var s=t.depth>i&&g(t,e,i+1),a=r.depth>i&&g(n,r,i+1),p=[];return w(null,t,i,p),s&&a&&e.index(i)==n.index(i)?(y(s,a),b(x(s,k(t,e,n,r,i+1)),p)):(s&&b(x(s,S(t,e,i+1)),p),w(e,n,i,p),a&&b(x(a,S(n,r,i+1)),p)),w(r,null,i,p),new o(p)}function S(t,e,n){var r=[];(w(null,t,n,r),t.depth>n)&&b(x(g(t,e,n+1),S(t,e,n+1)),r);return w(e,null,n,r),new o(r)}h.size.get=function(){return this.content.size-this.openStart-this.openEnd},f.prototype.insertAt=function(t,e){var n=d(this.content,t+this.openStart,e,null);return n&&new f(n,this.openStart,this.openEnd)},f.prototype.removeBetween=function(t,e){return new f(l(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},f.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},f.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},f.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},f.fromJSON=function(t,e){if(!e)return f.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new f(o.fromJSON(t,e.content),n,r)},f.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new f(t,n,r)},Object.defineProperties(f.prototype,h),f.empty=new f(o.empty,0,0);var O=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},E={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};O.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},E.parent.get=function(){return this.node(this.depth)},E.doc.get=function(){return this.node(0)},O.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},O.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},O.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},O.prototype.start=function(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1},O.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},O.prototype.before=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},O.prototype.after=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},E.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},E.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},E.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},O.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1,o=0;o<t;o++)r+=n.child(o).nodeSize;return r},O.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return c.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},O.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},O.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},O.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new N(this,t,n)},O.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},O.prototype.max=function(t){return t.pos>this.pos?t:this},O.prototype.min=function(t){return t.pos<this.pos?t:this},O.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},O.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,p=s.offset,c=o-p;if(n.push(i,a,r+p),!c)break;if((i=i.child(a)).isText)break;o=c-1,r+=p+1}return new O(e,n,o)},O.resolveCached=function(t,e){for(var n=0;n<M.length;n++){var r=M[n];if(r.pos==e&&r.doc==t)return r}var o=M[T]=O.resolve(t,e);return T=(T+1)%C,o},Object.defineProperties(O.prototype,E);var M=[],T=0,C=12,N=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},A={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};A.start.get=function(){return this.$from.before(this.depth+1)},A.end.get=function(){return this.$to.after(this.depth+1)},A.parent.get=function(){return this.$from.node(this.depth)},A.startIndex.get=function(){return this.$from.index(this.depth)},A.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(N.prototype,A);var j=Object.create(null),D=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||o.empty,this.marks=r||c.none},R={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};R.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},R.childCount.get=function(){return this.content.childCount},D.prototype.child=function(t){return this.content.child(t)},D.prototype.maybeChild=function(t){return this.content.maybeChild(t)},D.prototype.forEach=function(t){this.content.forEach(t)},D.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},D.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},R.textContent.get=function(){return this.textBetween(0,this.content.size,"")},D.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},R.firstChild.get=function(){return this.content.firstChild},R.lastChild.get=function(){return this.content.lastChild},D.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},D.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},D.prototype.hasMarkup=function(t,e,n){return this.type==t&&p(this.attrs,e||t.defaultAttrs||j)&&c.sameSet(this.marks,n||c.none)},D.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},D.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},D.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},D.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return f.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i).content.cut(r.pos-s,o.pos-s);return new f(a,r.depth-i,o.depth-i)},D.prototype.replace=function(t,e,n){return m(this.resolve(t),this.resolve(e),n)},D.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(!(e=e.maybeChild(r)))return null;if(o==t||e.isText)return e;t-=o+1}},D.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},D.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},D.prototype.resolve=function(t){return O.resolveCached(this,t)},D.prototype.resolveNoCache=function(t){return O.resolve(this,t)},D.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},R.isBlock.get=function(){return this.type.isBlock},R.isTextblock.get=function(){return this.type.isTextblock},R.inlineContent.get=function(){return this.type.inlineContent},R.isInline.get=function(){return this.type.isInline},R.isText.get=function(){return this.type.isText},R.isLeaf.get=function(){return this.type.isLeaf},R.isAtom.get=function(){return this.type.isAtom},D.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),function(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}(this.marks,t)},D.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},D.prototype.canReplace=function(t,e,n,r,i){void 0===n&&(n=o.empty),void 0===r&&(r=0),void 0===i&&(i=n.childCount);var s=this.contentMatchAt(t).matchFragment(n,r,i),a=s&&s.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(var p=r;p<i;p++)if(!this.type.allowsMarks(n.child(p).marks))return!1;return!0},D.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},D.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},D.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=c.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!c.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map((function(t){return t.type.name})));this.content.forEach((function(t){return t.check()}))},D.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},D.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=o.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(D.prototype,R);var I=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},z={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};I.parse=function(t,e){var n=new P(t,e);if(null==n.next)return I.empty;var r=B(n);n.next&&n.err("Unexpected trailing text");var o=function(t){var e=Object.create(null);return n(V(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];V(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new I(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(q);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}(function(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var p=n();return r(e,p),o(i(t.expr,p),p),[r(p)]}if("plus"==t.type){var c=n();return o(i(t.expr,e),c),o(i(t.expr,c),c),[r(c)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var u=e,f=0;f<t.min;f++){var h=n();o(i(t.expr,u),h),u=h}if(-1==t.max)o(i(t.expr,u),u);else for(var l=t.min;l<t.max;l++){var d=n();r(u,d),o(i(t.expr,u),d),u=d}return[r(u)]}if("name"==t.type)return[r(e,null,t.value)]}}}(r));return function(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var p=o.next[a],c=o.next[a+1];s.push(p.name),!i||p.isText||p.hasRequiredAttrs()||(i=!1),-1==r.indexOf(c)&&r.push(c)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(o,n),o},I.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},I.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},z.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},z.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},I.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},I.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];return function i(s,a){var p=s.matchFragment(t,n);if(p&&(!e||p.validEnd))return o.from(a.map((function(t){return t.createAndFill()})));for(var c=0;c<s.next.length;c+=2){var u=s.next[c],f=s.next[c+1];if(!u.isText&&!u.hasRequiredAttrs()&&-1==r.indexOf(f)){r.push(f);var h=i(f,a.concat(u));if(h)return h}}}(this,[])},I.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},I.prototype.computeWrapping=function(t){for(var e=Object.create(null),n=[{match:this,type:null,via:null}];n.length;){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var p=o.next[a];p.isLeaf||p.hasRequiredAttrs()||p.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:p.contentMatch,type:p,via:r}),e[p.name]=!0)}}},z.edgeCount.get=function(){return this.next.length>>1},I.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},I.prototype.toString=function(){var t=[];return function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(I.prototype,z),I.empty=new I(!0);var P=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},F={next:{configurable:!0}};function B(t){var e=[];do{e.push(L(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function L(t){var e=[];do{e.push(_(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function _(t){for(var e=function(t){if(t.eat("(")){var e=B(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=function(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}0==o.length&&t.err("No node type or group '"+e+"' found");return o}(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=J(t,e)}return e}function $(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function J(t,e){var n=$(t),r=n;return t.eat(",")&&(r="}"!=t.next?$(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function q(t,e){return e-t}function V(t,e){var n=[];return function e(r){var o=t[r];if(1==o.length&&!o[0].term)return e(o[0].to);n.push(r);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,p=s.to;a||-1!=n.indexOf(p)||e(p)}}(e),n.sort(q)}function W(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function H(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function U(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new Y(t[n]);return e}F.next.get=function(){return this.tokens[this.pos]},P.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},P.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(P.prototype,F);var G=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=U(n.attrs),this.defaultAttrs=W(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},K={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};K.isInline.get=function(){return!this.isBlock},K.isTextblock.get=function(){return this.isBlock&&this.inlineContent},K.isLeaf.get=function(){return this.contentMatch==I.empty},K.isAtom.get=function(){return this.isLeaf||this.spec.atom},G.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},G.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},G.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:H(this.attrs,t)},G.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new D(this,this.computeAttrs(t),o.from(e),c.setFrom(n))},G.prototype.createChecked=function(t,e,n){if(e=o.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new D(this,this.computeAttrs(t),e,c.setFrom(n))},G.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),(e=o.from(e)).size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var i=this.contentMatch.matchFragment(e).fillBefore(o.empty,!0);return i?new D(this,t,e.append(i),c.setFrom(n)):null},G.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},G.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},G.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},G.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:c.empty:t},G.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new G(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(G.prototype,K);var Y=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},X={isRequired:{configurable:!0}};X.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(Y.prototype,X);var Q=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=U(r.attrs),this.rank=e,this.excluded=null;var o=W(this.attrs);this.instance=o&&new c(this,o)};Q.prototype.create=function(t){return!t&&this.instance?this.instance:new c(this,H(this.attrs,t))},Q.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new Q(t,r++,e,o)})),n},Q.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},Q.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},Q.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var Z=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};Z.prototype.parse=function(t,e){void 0===e&&(e={});var n=new it(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},Z.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new it(this,e,!0);return n.addAll(t,null,e.from,e.to),f.maxOpen(n.finish())},Z.prototype.matchTag=function(t,e,n){for(var r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){var o=this.tags[r];if(at(t,o.tag)&&(void 0===o.namespace||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var i=o.getAttrs(t);if(!1===i)continue;o.attrs=i}return o}}},Z.prototype.matchStyle=function(t,e,n,r){for(var o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){var i=this.styles[o];if(!(0!=i.style.indexOf(t)||i.context&&!n.matchesContext(i.context)||i.style.length>t.length&&(61!=i.style.charCodeAt(t.length)||i.style.slice(t.length+1)!=e))){if(i.getAttrs){var s=i.getAttrs(e);if(!1===s)continue;i.attrs=s}return i}}},Z.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r];if((null==o.priority?50:o.priority)<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=pt(t)),t.mark=e}))};for(var o in t.marks)r(o);var i;for(var s in t.nodes)i=void 0,(i=t.nodes[s].spec.parseDOM)&&i.forEach((function(t){n(t=pt(t)),t.node=s}));return e},Z.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new Z(t,Z.schemaRules(t)))};var tt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},et={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},nt={ol:!0,ul:!0};function rt(t){return(t?1:0)|("full"===t?2:0)}var ot=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(4&s?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=c.none,this.pendingMarks=r,this.stashMarks=[]};ot.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(o.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},ot.prototype.finish=function(t){if(!(1&this.options)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=o.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(o.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},ot.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]},ot.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):ct(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var it=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=rt(e.preserveWhitespace)|(n?4:0);r=o?new ot(o.type,o.attrs,c.none,c.none,!0,e.topMatch||o.type.contentMatch,i):new ot(n?null:t.schema.topNodeType,null,c.none,c.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},st={top:{configurable:!0},currentPos:{configurable:!0}};function at(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function pt(t){var e={};for(var n in t)e[n]=t[n];return e}function ct(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}st.top.get=function(){return this.nodes[this.open]},it.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(function(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];for(;e=n.exec(t);)r.push(e[1],e[2].trim());return r}(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},it.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(1&n.options)e=2&n.options?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},it.prototype.addElement=function(t,e){var n,r=t.nodeName.toLowerCase();nt.hasOwnProperty(r)&&this.parser.normalizeLists&&function(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&nt.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(o?o.ignore:et.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var i,s=this.top,a=this.needsBlock;if(tt.hasOwnProperty(r))i=!0,s.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),i&&this.sync(s),this.needsBlock=a}else this.addElementByRule(t,o,!1===o.consuming?n:null)},it.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},it.prototype.ignoreFallback=function(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))},it.prototype.readStyles=function(t){var e=c.none;t:for(var n=0;n<t.length;n+=2)for(var r=null;;){var o=this.parser.matchStyle(t[n],t[n+1],this,r);if(!o)continue t;if(o.ignore)return null;if(e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),!1!==o.consuming)break;r=o}return e},it.prototype.addElementByRule=function(t,e,n){var r,o,i,s=this;e.node?(o=this.parser.schema.nodes[e.node]).isLeaf?this.insertNode(o.create(e.attrs))||this.leafFallback(t):r=this.enter(o,e.attrs,e.preserveWhitespace):(i=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(i));var a=this.top;if(o&&o.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var p=e.contentElement;"string"==typeof p?p=t.querySelector(p):"function"==typeof p&&(p=p(t)),p||(p=t),this.findAround(t,p,!0),this.addAll(p,r)}r&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},it.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&tt.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},it.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},it.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},it.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},it.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?-5&o.options:rt(r);4&o.options&&0==o.content.length&&(i|=4),this.nodes.push(new ot(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},it.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},it.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},it.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},st.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},it.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},it.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},it.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++){if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node))e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}},it.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},it.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!(this.isOpen||r&&r.parent.type!=this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var p=n[t];if(""==p){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var c=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!c||c.name!=p&&-1==c.groups.indexOf(p))return!1;a--}return!0};return s(n.length-1,this.open)},it.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},it.prototype.addPendingMark=function(t){var e=function(t,e){for(var n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},it.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n];if(r.pendingMarks.lastIndexOf(t)>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);var o=r.popFromStashMark(t);o&&r.type&&r.type.allowsMarkType(o.type)&&(r.activeMarks=o.addToSet(r.activeMarks))}if(r==e)break}},Object.defineProperties(it.prototype,st);var ut=function(t,e){this.nodes=t||{},this.marks=e||{}};function ft(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function ht(t){return t.document||window.document}ut.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=ht(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);for(var n=0,s=0;n<i.length&&s<t.marks.length;){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}for(;n<i.length;)o=i.pop(),i.pop();for(;s<t.marks.length;){var p=t.marks[s++],c=r.serializeMark(p,t.isInline,e);c&&(i.push(p,o),o.appendChild(c.dom),o=c.contentDOM||c.dom)}}o.appendChild(r.serializeNode(t,e))})),n},ut.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=ut.renderSpec(ht(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},ut.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},ut.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&ut.renderSpec(ht(n),r(t,e))},ut.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],p=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var c in p=2,a)if(null!=a[c]){var u=c.indexOf(" ");u>0?s.setAttributeNS(c.slice(0,u),c.slice(u+1),a[c]):s.setAttribute(c,a[c])}for(var f=p;f<e.length;f++){var h=e[f];if(0===h){if(f<e.length-1||f>p)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var l=ut.renderSpec(t,h,n),d=l.dom,m=l.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},ut.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new ut(this.nodesFromSchema(t),this.marksFromSchema(t)))},ut.nodesFromSchema=function(t){var e=ft(t.nodes);return e.text||(e.text=function(t){return t.text}),e},ut.marksFromSchema=function(t){return ft(t.marks)};var lt=Math.pow(2,16);function dt(t,e){return t+e*lt}function mt(t){return 65535&t}var vt=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},yt=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};yt.prototype.recover=function(t){var e=0,n=mt(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+function(t){return(t-(65535&t))/lt}(t)},yt.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},yt.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},yt.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var p=this.ranges[s+o],c=this.ranges[s+i],u=a+p;if(t<=u){var f=a+r+((p?t==a?-1:t==u?1:e:e)<0?0:c);if(n)return f;var h=t==(e<0?a:u)?null:dt(s/3,t-a);return new vt(f,e<0?t!=a:t!=u,h)}r+=c-p}return n?t+r:new vt(t+r)},yt.prototype.touches=function(t,e){for(var n=0,r=mt(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var p=this.ranges[s+o];if(t<=a+p&&s==3*r)return!0;n+=this.ranges[s+i]-p}return!1},yt.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),p=this.ranges[r+e],c=this.ranges[r+n];t(s,s+p,a,a+c),o+=c-p}},yt.prototype.invert=function(){return new yt(this.ranges,!this.inverted)},yt.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},yt.offset=function(t){return 0==t?yt.empty:new yt(t<0?[0,-t,0]:[0,0,t])},yt.empty=new yt([]);var gt=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function bt(t){var e=Error.call(this,t);return e.__proto__=bt.prototype,e}gt.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new gt(this.maps,this.mirror,t,e)},gt.prototype.copy=function(){return new gt(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},gt.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},gt.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},gt.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},gt.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},gt.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},gt.prototype.invert=function(){var t=new gt;return t.appendMappingInverted(this),t},gt.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},gt.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},gt.prototype._map=function(t,e,n){for(var r=!1,o=this.from;o<this.to;o++){var i=this.maps[o].mapResult(t,e);if(null!=i.recover){var s=this.getMirror(o);if(null!=s&&s>o&&s<this.to){o=s,t=this.maps[s].recover(i.recover);continue}}i.deleted&&(r=!0),t=i.pos}return n?t:new vt(t,r)},bt.prototype=Object.create(Error.prototype),bt.prototype.constructor=bt,bt.prototype.name="TransformError";var wt=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new gt},xt={before:{configurable:!0},docChanged:{configurable:!0}};function kt(){throw new Error("Override me")}xt.before.get=function(){return this.docs.length?this.docs[0]:this.doc},wt.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new bt(e.failed);return this},wt.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},xt.docChanged.get=function(){return this.steps.length>0},wt.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(wt.prototype,xt);var St=Object.create(null),Ot=function(){};Ot.prototype.apply=function(t){return kt()},Ot.prototype.getMap=function(){return yt.empty},Ot.prototype.invert=function(t){return kt()},Ot.prototype.map=function(t){return kt()},Ot.prototype.merge=function(t){return null},Ot.prototype.toJSON=function(){return kt()},Ot.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=St[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},Ot.jsonID=function(t,e){if(t in St)throw new RangeError("Duplicate use of step JSON ID "+t);return St[t]=e,e.prototype.jsonID=t,e};var Et=function(t,e){this.doc=t,this.failed=e};Et.ok=function(t){return new Et(t,null)},Et.fail=function(t){return new Et(null,t)},Et.fromReplace=function(t,e,n,r){try{return Et.ok(t.replace(e,n,r))}catch(t){if(t instanceof u)return Et.fail(t.message);throw t}};var Mt=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&Ct(t,this.from,this.to)?Et.fail("Structure replace would overwrite content"):Et.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new yt([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?f.empty:new f(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?f.empty:new f(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,f.fromJSON(t,n.slice),!!n.structure)},e}(Ot);Ot.jsonID("replace",Mt);var Tt=function(t){function e(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(Ct(t,this.from,this.gapFrom)||Ct(t,this.gapTo,this.to)))return Et.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return Et.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?Et.fromReplace(t,this.from,this.to,n):Et.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new yt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,f.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(Ot);function Ct(t,e,n){for(var r=t.resolve(e),o=n-e,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var s=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function Nt(t,e,n){for(var r=[],i=0;i<t.childCount;i++){var s=t.child(i);s.content.size&&(s=s.copy(Nt(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return o.fromArray(r)}Ot.jsonID("replaceAround",Tt),wt.prototype.lift=function(t,e){for(var n=t.$from,r=t.$to,i=t.depth,s=n.before(i+1),a=r.after(i+1),p=s,c=a,u=o.empty,h=0,l=i,d=!1;l>e;l--)d||n.index(l)>0?(d=!0,u=o.from(n.node(l).copy(u)),h++):p--;for(var m=o.empty,v=0,y=i,g=!1;y>e;y--)g||r.after(y+1)<r.end(y)?(g=!0,m=o.from(r.node(y).copy(m)),v++):c++;return this.step(new Tt(p,c,s,a,new f(u.append(m),h,v),u.size-h,!0))},wt.prototype.wrap=function(t,e){for(var n=o.empty,r=e.length-1;r>=0;r--)n=o.from(e[r].type.create(e[r].attrs,n));var i=t.start,s=t.end;return this.step(new Tt(i,s,i,s,new f(n,0,0),e.length,!0))},wt.prototype.setBlockType=function(t,e,n,r){var i=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var s=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,r)&&function(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(i.doc,i.mapping.slice(s).map(e),n)){i.clearIncompatible(i.mapping.slice(s).map(e,1),n);var a=i.mapping.slice(s),p=a.map(e,1),c=a.map(e+t.nodeSize,1);return i.step(new Tt(p,c,p+1,c-1,new f(o.from(n.create(r,null,t.marks)),0,0),1,!0)),!1}})),this},wt.prototype.setNodeMarkup=function(t,e,n,r){var i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");e||(e=i.type);var s=e.create(n,null,r||i.marks);if(i.isLeaf)return this.replaceWith(t,t+i.nodeSize,s);if(!e.validContent(i.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new Tt(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new f(o.from(s),0,0),1,!0))},wt.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var r=this.doc.resolve(t),i=o.empty,s=o.empty,a=r.depth,p=r.depth-e,c=e-1;a>p;a--,c--){i=o.from(r.node(a).copy(i));var u=n&&n[c];s=o.from(u?u.type.create(u.attrs,s):r.node(a).copy(s))}return this.step(new Mt(t,t,new f(i.append(s),e,e),!0))},wt.prototype.join=function(t,e){void 0===e&&(e=1);var n=new Mt(t-e,t+e,f.empty,!0);return this.step(n)};var At=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new f(Nt(n.content,(function(t,n){return t.isAtom&&n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return Et.fromReplace(t,this.from,this.to,i)},e.prototype.invert=function(){return new jt(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(Ot);Ot.jsonID("addMark",At);var jt=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new f(Nt(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return Et.fromReplace(t,this.from,this.to,r)},e.prototype.invert=function(){return new At(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(Ot);function Dt(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}Ot.jsonID("removeMark",jt),wt.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,p,c){if(r.isInline){var u=r.marks;if(!n.isInSet(u)&&c.type.allowsMarkType(n.type)){for(var f=Math.max(p,t),h=Math.min(p+r.nodeSize,e),l=n.addToSet(u),d=0;d<u.length;d++)u[d].isInSet(l)||(s&&s.to==f&&s.mark.eq(u[d])?s.to=h:o.push(s=new jt(f,h,u[d])));a&&a.to==f?a.to=h:i.push(a=new At(f,h,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},wt.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof Q)for(var p,c=r.marks;p=n.isInSet(c);)(a||(a=[])).push(p),c=p.removeFromSet(c);else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var u=Math.min(s+r.nodeSize,e),f=0;f<a.length;f++){for(var h=a[f],l=void 0,d=0;d<o.length;d++){var m=o[d];m.step==i-1&&h.eq(o[d].style)&&(l=m)}l?(l.to=u,l.step=i):o.push({style:h,from:Math.max(s,t),to:u,step:i})}}})),o.forEach((function(t){return r.step(new jt(t.from,t.to,t.style))})),this},wt.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var r=this.doc.nodeAt(t),i=[],s=t+1,a=0;a<r.childCount;a++){var p=r.child(a),c=s+p.nodeSize,u=n.matchType(p.type,p.attrs);if(u){n=u;for(var h=0;h<p.marks.length;h++)e.allowsMarkType(p.marks[h].type)||this.step(new jt(s,c,p.marks[h]))}else i.push(new Mt(s,c,f.empty));s=c}if(!n.validEnd){var l=n.fillBefore(o.empty,!0);this.replace(s,s,new f(l,0,0))}for(var d=i.length-1;d>=0;d--)this.step(i[d]);return this},wt.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=f.empty);var r=function(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=f.empty),e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return Dt(o,i,r)?new Mt(e,n,r):new Rt(o,i,r).fit()}(this.doc,t,e,n);return r&&this.step(r),this},wt.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new f(o.from(n),0,0))},wt.prototype.delete=function(t,e){return this.replace(t,e,f.empty)},wt.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var Rt=function(t,e,n){this.$to=e,this.$from=t,this.unplaced=n,this.frontier=[];for(var r=0;r<=t.depth;r++){var i=t.node(r);this.frontier.push({type:i.type,match:i.contentMatchAt(t.indexAfter(r))})}this.placed=o.empty;for(var s=t.depth;s>0;s--)this.placed=o.from(t.node(s).copy(this.placed))},It={depth:{configurable:!0}};function zt(t,e,n){return 0==e?t.cutByIndex(n):t.replaceChild(0,t.firstChild.copy(zt(t.firstChild.content,e-1,n)))}function Pt(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Pt(t.lastChild.content,e-1,n)))}function Ft(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function Bt(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,Bt(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(o.empty,!0)))),t.copy(r)}function Lt(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!function(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}(n,i.content,s)?a:null}function _t(t,e,n,r,i){if(e<n){var s=t.firstChild;t=t.replaceChild(0,s.copy(_t(s.content,e+1,n,r,s)))}if(e>r){var a=i.contentMatchAt(0),p=a.fillBefore(t).append(t);t=p.append(a.matchFragment(p).fillBefore(o.empty,!0))}return t}function $t(t,e){for(var n=[],r=Math.min(t.depth,e.depth);r>=0;r--){var o=t.start(r);if(o<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;o==e.start(r)&&n.push(r)}return n}It.depth.get=function(){return this.frontier.length-1},Rt.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;for(var i=this.placed,s=r.depth,a=o.depth;s&&a&&1==i.childCount;)i=i.firstChild.content,s--,a--;var p=new f(i,s,a);return e>-1?new Tt(r.pos,e,this.$to.pos,this.$to.end(),p,n):p.size||r.pos!=this.$to.pos?new Mt(r.pos,o.pos,p):void 0},Rt.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--)for(var n=void 0,r=(e?(n=Ft(this.unplaced.content,e-1).firstChild).content:this.unplaced.content).firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],a=s.type,p=s.match,c=void 0,u=void 0;if(1==t&&(r?p.matchType(r.type)||(u=p.fillBefore(o.from(r),!1)):a.compatibleContent(n.type)))return{sliceDepth:e,frontierDepth:i,parent:n,inject:u};if(2==t&&r&&(c=p.findWrapping(r.type)))return{sliceDepth:e,frontierDepth:i,parent:n,wrap:c};if(n&&p.matchType(n.type))break}},Rt.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Ft(e,n);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new f(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),!0)},Rt.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Ft(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new f(zt(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new f(zt(e,n,1),n,r)},Rt.prototype.placeNodes=function(t){for(var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,i=t.inject,s=t.wrap;this.depth>n;)this.closeFrontierNode();if(s)for(var a=0;a<s.length;a++)this.openFrontierNode(s[a]);var p=this.unplaced,c=r?r.content:p.content,u=p.openStart-e,h=0,l=[],d=this.frontier[n],m=d.match,v=d.type;if(i){for(var y=0;y<i.childCount;y++)l.push(i.child(y));m=m.matchFragment(i)}for(var g=c.size+e-(p.content.size-p.openEnd);h<c.childCount;){var b=c.child(h),w=m.matchType(b.type);if(!w)break;(++h>1||0==u||b.content.size)&&(m=w,l.push(Bt(b.mark(v.allowedMarks(b.marks)),1==h?u:0,h==c.childCount?g:-1)))}var x=h==c.childCount;x||(g=-1),this.placed=Pt(this.placed,n,o.from(l)),this.frontier[n].match=m,x&&g<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var k=0,S=c;k<g;k++){var O=S.lastChild;this.frontier.push({type:O.type,match:O.contentMatchAt(O.childCount)}),S=O.content}this.unplaced=x?0==e?f.empty:new f(zt(p.content,e-1,1),e-1,g<0?p.openEnd:e-1):new f(zt(p.content,e,h),p.openStart,p.openEnd)},Rt.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!Lt(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var n=this.$to.depth,r=this.$to.after(n);n>1&&r==this.$to.end(--n);)++r;return r},Rt.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=Lt(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var p=this.frontier[a],c=p.match,u=Lt(t,a,p.type,c,!0);if(!u||u.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},Rt.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Pt(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t},Rt.prototype.openFrontierNode=function(t,e,n){var r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=Pt(this.placed,this.depth,o.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})},Rt.prototype.closeFrontierNode=function(){var t=this.frontier.pop().match.fillBefore(o.empty,!0);t.childCount&&(this.placed=Pt(this.placed,this.frontier.length,t))},Object.defineProperties(Rt.prototype,It),wt.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if(Dt(r,o,n))return this.step(new Mt(t,e,n));var i=$t(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,p=r.pos-1;a>0;a--,p--){var c=r.node(a).type.spec;if(c.defining||c.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==p&&i.splice(1,0,-a)}for(var u=i.indexOf(s),h=[],l=n.openStart,d=n.content,m=0;;m++){var v=d.firstChild;if(h.push(v),m==n.openStart)break;d=v.content}l>0&&h[l-1].type.spec.defining&&r.node(u).type!=h[l-1].type?l-=1:l>=2&&h[l-1].isTextblock&&h[l-2].type.spec.defining&&r.node(u).type!=h[l-2].type&&(l-=2);for(var y=n.openStart;y>=0;y--){var g=(y+l+1)%(n.openStart+1),b=h[g];if(b)for(var w=0;w<i.length;w++){var x=i[(w+u)%i.length],k=!0;x<0&&(k=!1,x=-x);var S=r.node(x-1),O=r.index(x-1);if(S.canReplaceWith(O,O,b.type,b.marks))return this.replace(r.before(x),k?o.after(x):e,new f(_t(n.content,0,n.openStart,g),g,n.openEnd))}}for(var E=this.steps.length,M=i.length-1;M>=0&&(this.replace(t,e,n),!(this.steps.length>E));M--){var T=i[M];T<0||(t=r.before(T),e=o.after(T))}return this},wt.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var r=function(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}(this.doc,t,n.type);null!=r&&(t=e=r)}return this.replaceRange(t,e,new f(o.from(n),0,0))},wt.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=$t(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var p=1;p<=n.depth&&p<=r.depth;p++)if(t-n.start(p)==n.depth-p&&e>n.end(p)&&r.end(p)-e!=r.depth-p)return this.delete(n.before(p),e);return this.delete(t,e)};var Jt=Object.create(null),qt=function(t,e,n){this.ranges=n||[new Wt(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},Vt={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Vt.anchor.get=function(){return this.$anchor.pos},Vt.head.get=function(){return this.$head.pos},Vt.from.get=function(){return this.$from.pos},Vt.to.get=function(){return this.$to.pos},Vt.$from.get=function(){return this.ranges[0].$from},Vt.$to.get=function(){return this.ranges[0].$to},Vt.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},qt.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},qt.prototype.replace=function(t,e){void 0===e&&(e=f.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var p=s[a],c=p.$from,u=p.$to,h=t.mapping.slice(i);t.replaceRange(h.map(c.pos),h.map(u.pos),a?f.empty:e),0==a&&Zt(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},qt.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,p=t.mapping.slice(n),c=p.map(s.pos),u=p.map(a.pos);o?t.deleteRange(c,u):(t.replaceRangeWith(c,u,e),Zt(t,n,e.isInline?-1:1))}},qt.findFrom=function(t,e,n){var r=t.parent.inlineContent?new Ht(t):Qt(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?Qt(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):Qt(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},qt.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new Yt(t.node(0))},qt.atStart=function(t){return Qt(t,t,0,0,1)||new Yt(t)},qt.atEnd=function(t){return Qt(t,t,t.content.size,t.childCount,-1)||new Yt(t)},qt.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=Jt[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},qt.jsonID=function(t,e){if(t in Jt)throw new RangeError("Duplicate use of selection JSON ID "+t);return Jt[t]=e,e.prototype.jsonID=t,e},qt.prototype.getBookmark=function(){return Ht.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(qt.prototype,Vt),qt.prototype.visible=!0;var Wt=function(t,e){this.$from=t,this.$to=e},Ht=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=f.empty),t.prototype.replace.call(this,e,n),n==f.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new Ut(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i||(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor).pos<r.pos!=i<0)&&(n=r),new e(n,r)},Object.defineProperties(e.prototype,n),e}(qt);qt.jsonID("text",Ht);var Ut=function(t,e){this.anchor=t,this.head=e};Ut.prototype.map=function(t){return new Ut(t.map(this.anchor),t.map(this.head))},Ut.prototype.resolve=function(t){return Ht.between(t.resolve(this.anchor),t.resolve(this.head))};var Gt=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new f(o.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Kt(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(qt);Gt.prototype.visible=!1,qt.jsonID("node",Gt);var Kt=function(t){this.anchor=t};Kt.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new Ut(r,r):new Kt(r)},Kt.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&Gt.isSelectable(n)?new Gt(e):qt.near(e)};var Yt=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=f.empty),n==f.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return Xt},e}(qt);qt.jsonID("all",Yt);var Xt={map:function(){return this},resolve:function(t){return new Yt(t)}};function Qt(t,e,n,r,o,i){if(e.inlineContent)return Ht.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&Gt.isSelectable(a))return Gt.create(t,n-(o<0?a.nodeSize:0))}else{var p=Qt(t,a,n+o,o<0?a.childCount:0,o,i);if(p)return p}n+=a.nodeSize*o}}function Zt(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o,i=t.steps[r];if(i instanceof Mt||i instanceof Tt)t.mapping.maps[r].forEach((function(t,e,n,r){null==o&&(o=r)})),t.setSelection(qt.near(t.doc.resolve(o),n))}}var te=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this},n.selectionSet.get=function(){return(1&this.updated)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=2,this},e.prototype.ensureMarks=function(t){return c.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(2&this.updated)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=-3&this.updated,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||c.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(qt.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=4,this},n.scrolledIntoView.get=function(){return(4&this.updated)>0},Object.defineProperties(e.prototype,n),e}(wt);function ee(t,e){return e&&t?t.bind(e):t}var ne=function(t,e,n){this.name=t,this.init=ee(e.init,n),this.apply=ee(e.apply,n)},re=[new ne("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new ne("selection",{init:function(t,e){return t.selection||qt.atStart(e.doc)},apply:function(t){return t.selection}}),new ne("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new ne("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],oe=function(t,e){var n=this;this.schema=t,this.fields=re.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new ne(t.key,t.spec.state,t))}))},ie=function(t){this.config=t},se={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};se.schema.get=function(){return this.config.schema},se.plugins.get=function(){return this.config.plugins},ie.prototype.apply=function(t){return this.applyTransaction(t).state},ie.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},ie.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,p=r?r[i].state:this,c=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,p,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",t),!r){r=[];for(var u=0;u<this.config.plugins.length;u++)r.push(u<i?{state:n,n:e.length}:{state:this,n:0})}e.push(c),n=n.applyInner(c),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},ie.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new ie(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<ae.length;i++)ae[i](this,t,e);return e},se.tr.get=function(){return new te(this)},ie.create=function(t){for(var e=new oe(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new ie(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},ie.prototype.reconfigure=function(t){for(var e=new oe(this.schema,t.plugins),n=e.fields,r=new ie(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},ie.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},ie.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new oe(t.schema,t.plugins),o=new ie(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=D.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=qt.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},ie.addApplyListener=function(t){ae.push(t)},ie.removeApplyListener=function(t){var e=ae.indexOf(t);e>-1&&ae.splice(e,1)},Object.defineProperties(ie.prototype,se);var ae=[];function pe(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=pe(o,e,{})),n[r]=o}return n}var ce=function(t){this.props={},t.props&&pe(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:fe("plugin")};ce.prototype.getState=function(t){return t[this.key]};var ue=Object.create(null);function fe(t){return t in ue?t+"$"+ ++ue[t]:(ue[t]=0,t+"$")}var he=function(t){void 0===t&&(t="key"),this.key=fe(t)};he.prototype.get=function(t){return t.config.pluginsByKey[this.key]},he.prototype.getState=function(t){return t[this.key]};var le="top",de="bottom",me="right",ve="left",ye="auto",ge=[le,de,me,ve],be="start",we="end",xe="viewport",ke="popper",Se=ge.reduce((function(t,e){return t.concat([e+"-"+be,e+"-"+we])}),[]),Oe=[].concat(ge,[ye]).reduce((function(t,e){return t.concat([e,e+"-"+be,e+"-"+we])}),[]),Ee=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Me(t){return t?(t.nodeName||"").toLowerCase():null}function Te(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ce(t){return t instanceof Te(t).Element||t instanceof Element}function Ne(t){return t instanceof Te(t).HTMLElement||t instanceof HTMLElement}function Ae(t){return"undefined"!=typeof ShadowRoot&&(t instanceof Te(t).ShadowRoot||t instanceof ShadowRoot)}var je={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];Ne(o)&&Me(o)&&(Object.assign(o.style,n),Object.keys(r).forEach((function(t){var e=r[t];!1===e?o.removeAttribute(t):o.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach((function(t){var r=e.elements[t],o=e.attributes[t]||{},i=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]).reduce((function(t,e){return t[e]="",t}),{});Ne(r)&&Me(r)&&(Object.assign(r.style,i),Object.keys(o).forEach((function(t){r.removeAttribute(t)})))}))}},requires:["computeStyles"]};function De(t){return t.split("-")[0]}function Re(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left,x:e.left,y:e.top}}function Ie(t){var e=Re(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function ze(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&Ae(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Pe(t){return Te(t).getComputedStyle(t)}function Fe(t){return["table","td","th"].indexOf(Me(t))>=0}function Be(t){return((Ce(t)?t.ownerDocument:t.document)||window.document).documentElement}function Le(t){return"html"===Me(t)?t:t.assignedSlot||t.parentNode||(Ae(t)?t.host:null)||Be(t)}function _e(t){return Ne(t)&&"fixed"!==Pe(t).position?t.offsetParent:null}function $e(t){for(var e=Te(t),n=_e(t);n&&Fe(n)&&"static"===Pe(n).position;)n=_e(n);return n&&("html"===Me(n)||"body"===Me(n)&&"static"===Pe(n).position)?e:n||function(t){var e=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&Ne(t)&&"fixed"===Pe(t).position)return null;for(var n=Le(t);Ne(n)&&["html","body"].indexOf(Me(n))<0;){var r=Pe(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||e&&"filter"===r.willChange||e&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(t)||e}function Je(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}var qe=Math.max,Ve=Math.min,We=Math.round;function He(t,e,n){return qe(t,Ve(e,n))}function Ue(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function Ge(t,e){return e.reduce((function(e,n){return e[n]=t,e}),{})}var Ke={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ye(t){var e,n=t.popper,r=t.popperRect,o=t.placement,i=t.offsets,s=t.position,a=t.gpuAcceleration,p=t.adaptive,c=t.roundOffsets,u=!0===c?function(t){var e=t.x,n=t.y,r=window.devicePixelRatio||1;return{x:We(We(e*r)/r)||0,y:We(We(n*r)/r)||0}}(i):"function"==typeof c?c(i):i,f=u.x,h=void 0===f?0:f,l=u.y,d=void 0===l?0:l,m=i.hasOwnProperty("x"),v=i.hasOwnProperty("y"),y=ve,g=le,b=window;if(p){var w=$e(n),x="clientHeight",k="clientWidth";w===Te(n)&&"static"!==Pe(w=Be(n)).position&&(x="scrollHeight",k="scrollWidth"),w=w,o===le&&(g=de,d-=w[x]-r.height,d*=a?1:-1),o===ve&&(y=me,h-=w[k]-r.width,h*=a?1:-1)}var S,O=Object.assign({position:s},p&&Ke);return a?Object.assign({},O,((S={})[g]=v?"0":"",S[y]=m?"0":"",S.transform=(b.devicePixelRatio||1)<2?"translate("+h+"px, "+d+"px)":"translate3d("+h+"px, "+d+"px, 0)",S)):Object.assign({},O,((e={})[g]=v?d+"px":"",e[y]=m?h+"px":"",e.transform="",e))}var Xe={passive:!0};var Qe={left:"right",right:"left",bottom:"top",top:"bottom"};function Ze(t){return t.replace(/left|right|bottom|top/g,(function(t){return Qe[t]}))}var tn={start:"end",end:"start"};function en(t){return t.replace(/start|end/g,(function(t){return tn[t]}))}function nn(t){var e=Te(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function rn(t){return Re(Be(t)).left+nn(t).scrollLeft}function on(t){var e=Pe(t),n=e.overflow,r=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+o+r)}function sn(t){return["html","body","#document"].indexOf(Me(t))>=0?t.ownerDocument.body:Ne(t)&&on(t)?t:sn(Le(t))}function an(t,e){var n;void 0===e&&(e=[]);var r=sn(t),o=r===(null==(n=t.ownerDocument)?void 0:n.body),i=Te(r),s=o?[i].concat(i.visualViewport||[],on(r)?r:[]):r,a=e.concat(s);return o?a:a.concat(an(Le(s)))}function pn(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function cn(t,e){return e===xe?pn(function(t){var e=Te(t),n=Be(t),r=e.visualViewport,o=n.clientWidth,i=n.clientHeight,s=0,a=0;return r&&(o=r.width,i=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(s=r.offsetLeft,a=r.offsetTop)),{width:o,height:i,x:s+rn(t),y:a}}(t)):Ne(e)?function(t){var e=Re(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}(e):pn(function(t){var e,n=Be(t),r=nn(t),o=null==(e=t.ownerDocument)?void 0:e.body,i=qe(n.scrollWidth,n.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),s=qe(n.scrollHeight,n.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),a=-r.scrollLeft+rn(t),p=-r.scrollTop;return"rtl"===Pe(o||n).direction&&(a+=qe(n.clientWidth,o?o.clientWidth:0)-i),{width:i,height:s,x:a,y:p}}(Be(t)))}function un(t,e,n){var r="clippingParents"===e?function(t){var e=an(Le(t)),n=["absolute","fixed"].indexOf(Pe(t).position)>=0&&Ne(t)?$e(t):t;return Ce(n)?e.filter((function(t){return Ce(t)&&ze(t,n)&&"body"!==Me(t)})):[]}(t):[].concat(e),o=[].concat(r,[n]),i=o[0],s=o.reduce((function(e,n){var r=cn(t,n);return e.top=qe(r.top,e.top),e.right=Ve(r.right,e.right),e.bottom=Ve(r.bottom,e.bottom),e.left=qe(r.left,e.left),e}),cn(t,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function fn(t){return t.split("-")[1]}function hn(t){var e,n=t.reference,r=t.element,o=t.placement,i=o?De(o):null,s=o?fn(o):null,a=n.x+n.width/2-r.width/2,p=n.y+n.height/2-r.height/2;switch(i){case le:e={x:a,y:n.y-r.height};break;case de:e={x:a,y:n.y+n.height};break;case me:e={x:n.x+n.width,y:p};break;case ve:e={x:n.x-r.width,y:p};break;default:e={x:n.x,y:n.y}}var c=i?Je(i):null;if(null!=c){var u="y"===c?"height":"width";switch(s){case be:e[c]=e[c]-(n[u]/2-r[u]/2);break;case we:e[c]=e[c]+(n[u]/2-r[u]/2)}}return e}function ln(t,e){void 0===e&&(e={});var n=e,r=n.placement,o=void 0===r?t.placement:r,i=n.boundary,s=void 0===i?"clippingParents":i,a=n.rootBoundary,p=void 0===a?xe:a,c=n.elementContext,u=void 0===c?ke:c,f=n.altBoundary,h=void 0!==f&&f,l=n.padding,d=void 0===l?0:l,m=Ue("number"!=typeof d?d:Ge(d,ge)),v=u===ke?"reference":ke,y=t.elements.reference,g=t.rects.popper,b=t.elements[h?v:u],w=un(Ce(b)?b:b.contextElement||Be(t.elements.popper),s,p),x=Re(y),k=hn({reference:x,element:g,strategy:"absolute",placement:o}),S=pn(Object.assign({},g,k)),O=u===ke?S:x,E={top:w.top-O.top+m.top,bottom:O.bottom-w.bottom+m.bottom,left:w.left-O.left+m.left,right:O.right-w.right+m.right},M=t.modifiersData.offset;if(u===ke&&M){var T=M[o];Object.keys(E).forEach((function(t){var e=[me,de].indexOf(t)>=0?1:-1,n=[le,de].indexOf(t)>=0?"y":"x";E[t]+=T[n]*e}))}return E}function dn(t,e){void 0===e&&(e={});var n=e,r=n.placement,o=n.boundary,i=n.rootBoundary,s=n.padding,a=n.flipVariations,p=n.allowedAutoPlacements,c=void 0===p?Oe:p,u=fn(r),f=u?a?Se:Se.filter((function(t){return fn(t)===u})):ge,h=f.filter((function(t){return c.indexOf(t)>=0}));0===h.length&&(h=f,"production"!==process.env.NODE_ENV&&console.error(["Popper: The `allowedAutoPlacements` option did not allow any","placements. Ensure the `placement` option matches the variation","of the allowed placements.",'For example, "auto" cannot be used to allow "bottom-start".','Use "auto-start" instead.'].join(" ")));var l=h.reduce((function(e,n){return e[n]=ln(t,{placement:n,boundary:o,rootBoundary:i,padding:s})[De(n)],e}),{});return Object.keys(l).sort((function(t,e){return l[t]-l[e]}))}function mn(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function vn(t){return[le,me,de,ve].some((function(e){return t[e]>=0}))}function yn(t,e,n){void 0===n&&(n=!1);var r,o,i=Be(e),s=Re(t),a=Ne(e),p={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(a||!a&&!n)&&(("body"!==Me(e)||on(i))&&(p=(r=e)!==Te(r)&&Ne(r)?{scrollLeft:(o=r).scrollLeft,scrollTop:o.scrollTop}:nn(r)),Ne(e)?((c=Re(e)).x+=e.clientLeft,c.y+=e.clientTop):i&&(c.x=rn(i))),{x:s.left+p.scrollLeft-c.x,y:s.top+p.scrollTop-c.y,width:s.width,height:s.height}}function gn(t){var e=new Map,n=new Set,r=[];function o(t){n.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!n.has(t)){var r=e.get(t);r&&o(r)}})),r.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){n.has(t.name)||o(t)})),r}function bn(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return[].concat(n).reduce((function(t,e){return t.replace(/%s/,e)}),t)}var wn='Popper: modifier "%s" provided an invalid %s property, expected %s but got %s',xn=["name","enabled","phase","fn","effect","requires","options"];var kn="Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.",Sn={placement:"bottom",modifiers:[],strategy:"absolute"};function On(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function En(t){void 0===t&&(t={});var e=t,n=e.defaultModifiers,r=void 0===n?[]:n,o=e.defaultOptions,i=void 0===o?Sn:o;return function(t,e,n){void 0===n&&(n=i);var o,s,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},Sn,i),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},p=[],c=!1,u={state:a,setOptions:function(n){f(),a.options=Object.assign({},i,a.options,n),a.scrollParents={reference:Ce(t)?an(t):t.contextElement?an(t.contextElement):[],popper:an(e)};var o,s,c,h=function(t){var e=gn(t);return Ee.reduce((function(t,n){return t.concat(e.filter((function(t){return t.phase===n})))}),[])}(function(t){var e=t.reduce((function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign({},n,e,{options:Object.assign({},n.options,e.options),data:Object.assign({},n.data,e.data)}):e,t}),{});return Object.keys(e).map((function(t){return e[t]}))}([].concat(r,a.options.modifiers)));if(a.orderedModifiers=h.filter((function(t){return t.enabled})),"production"!==process.env.NODE_ENV){if(function(t){t.forEach((function(e){Object.keys(e).forEach((function(n){switch(n){case"name":"string"!=typeof e.name&&console.error(bn(wn,String(e.name),'"name"','"string"','"'+String(e.name)+'"'));break;case"enabled":"boolean"!=typeof e.enabled&&console.error(bn(wn,e.name,'"enabled"','"boolean"','"'+String(e.enabled)+'"'));case"phase":Ee.indexOf(e.phase)<0&&console.error(bn(wn,e.name,'"phase"',"either "+Ee.join(", "),'"'+String(e.phase)+'"'));break;case"fn":"function"!=typeof e.fn&&console.error(bn(wn,e.name,'"fn"','"function"','"'+String(e.fn)+'"'));break;case"effect":"function"!=typeof e.effect&&console.error(bn(wn,e.name,'"effect"','"function"','"'+String(e.fn)+'"'));break;case"requires":Array.isArray(e.requires)||console.error(bn(wn,e.name,'"requires"','"array"','"'+String(e.requires)+'"'));break;case"requiresIfExists":Array.isArray(e.requiresIfExists)||console.error(bn(wn,e.name,'"requiresIfExists"','"array"','"'+String(e.requiresIfExists)+'"'));break;case"options":case"data":break;default:console.error('PopperJS: an invalid property has been provided to the "'+e.name+'" modifier, valid properties are '+xn.map((function(t){return'"'+t+'"'})).join(", ")+'; but "'+n+'" was provided.')}e.requires&&e.requires.forEach((function(n){null==t.find((function(t){return t.name===n}))&&console.error(bn('Popper: modifier "%s" requires "%s", but "%s" modifier is not available',String(e.name),n,n))}))}))}))}((o=[].concat(h,a.options.modifiers),s=function(t){return t.name},c=new Set,o.filter((function(t){var e=s(t);if(!c.has(e))return c.add(e),!0})))),De(a.options.placement)===ye)a.orderedModifiers.find((function(t){return"flip"===t.name}))||console.error(['Popper: "auto" placements require the "flip" modifier be',"present and enabled to work."].join(" "));var l=Pe(e);[l.marginTop,l.marginRight,l.marginBottom,l.marginLeft].some((function(t){return parseFloat(t)}))&&console.warn(['Popper: CSS "margin" styles cannot be used to apply padding',"between the popper and its reference element or boundary.","To replicate margin, use the `offset` modifier, as well as","the `padding` option in the `preventOverflow` and `flip`","modifiers."].join(" "))}return a.orderedModifiers.forEach((function(t){var e=t.name,n=t.options,r=void 0===n?{}:n,o=t.effect;if("function"==typeof o){var i=o({state:a,name:e,instance:u,options:r}),s=function(){};p.push(i||s)}})),u.update()},forceUpdate:function(){if(!c){var t=a.elements,e=t.reference,n=t.popper;if(On(e,n)){a.rects={reference:yn(e,$e(n),"fixed"===a.options.strategy),popper:Ie(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(t){return a.modifiersData[t.name]=Object.assign({},t.data)}));for(var r=0,o=0;o<a.orderedModifiers.length;o++){if("production"!==process.env.NODE_ENV&&(r+=1)>100){console.error("Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.");break}if(!0!==a.reset){var i=a.orderedModifiers[o],s=i.fn,p=i.options,f=void 0===p?{}:p,h=i.name;"function"==typeof s&&(a=s({state:a,options:f,name:h,instance:u})||a)}else a.reset=!1,o=-1}}else"production"!==process.env.NODE_ENV&&console.error(kn)}},update:(o=function(){return new Promise((function(t){u.forceUpdate(),t(a)}))},function(){return s||(s=new Promise((function(t){Promise.resolve().then((function(){s=void 0,t(o())}))}))),s}),destroy:function(){f(),c=!0}};if(!On(t,e))return"production"!==process.env.NODE_ENV&&console.error(kn),u;function f(){p.forEach((function(t){return t()})),p=[]}return u.setOptions(n).then((function(t){!c&&n.onFirstUpdate&&n.onFirstUpdate(t)})),u}}var Mn=En({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,n=t.instance,r=t.options,o=r.scroll,i=void 0===o||o,s=r.resize,a=void 0===s||s,p=Te(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return i&&c.forEach((function(t){t.addEventListener("scroll",n.update,Xe)})),a&&p.addEventListener("resize",n.update,Xe),function(){i&&c.forEach((function(t){t.removeEventListener("scroll",n.update,Xe)})),a&&p.removeEventListener("resize",n.update,Xe)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,n=t.name;e.modifiersData[n]=hn({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,n=t.options,r=n.gpuAcceleration,o=void 0===r||r,i=n.adaptive,s=void 0===i||i,a=n.roundOffsets,p=void 0===a||a;if("production"!==process.env.NODE_ENV){var c=Pe(e.elements.popper).transitionProperty||"";s&&["transform","top","right","bottom","left"].some((function(t){return c.indexOf(t)>=0}))&&console.warn(["Popper: Detected CSS transitions on at least one of the following",'CSS properties: "transform", "top", "right", "bottom", "left".',"\n\n",'Disable the "computeStyles" modifier\'s `adaptive` option to allow',"for smooth transitions, or remove these properties from the CSS","transition declaration on the popper element if only transitioning","opacity or background-color for example.","\n\n","We recommend using the popper element as a wrapper around an inner","element that can have any CSS property transitioned for animations."].join(" "))}var u={placement:De(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,Ye(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:p})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,Ye(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:p})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},je,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,n=t.options,r=t.name,o=n.offset,i=void 0===o?[0,0]:o,s=Oe.reduce((function(t,n){return t[n]=function(t,e,n){var r=De(t),o=[ve,le].indexOf(r)>=0?-1:1,i="function"==typeof n?n(Object.assign({},e,{placement:t})):n,s=i[0],a=i[1];return s=s||0,a=(a||0)*o,[ve,me].indexOf(r)>=0?{x:a,y:s}:{x:s,y:a}}(n,e.rects,i),t}),{}),a=s[e.placement],p=a.x,c=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=p,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=s}},{name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var o=n.mainAxis,i=void 0===o||o,s=n.altAxis,a=void 0===s||s,p=n.fallbackPlacements,c=n.padding,u=n.boundary,f=n.rootBoundary,h=n.altBoundary,l=n.flipVariations,d=void 0===l||l,m=n.allowedAutoPlacements,v=e.options.placement,y=De(v),g=p||(y===v||!d?[Ze(v)]:function(t){if(De(t)===ye)return[];var e=Ze(t);return[en(t),e,en(e)]}(v)),b=[v].concat(g).reduce((function(t,n){return t.concat(De(n)===ye?dn(e,{placement:n,boundary:u,rootBoundary:f,padding:c,flipVariations:d,allowedAutoPlacements:m}):n)}),[]),w=e.rects.reference,x=e.rects.popper,k=new Map,S=!0,O=b[0],E=0;E<b.length;E++){var M=b[E],T=De(M),C=fn(M)===be,N=[le,de].indexOf(T)>=0,A=N?"width":"height",j=ln(e,{placement:M,boundary:u,rootBoundary:f,altBoundary:h,padding:c}),D=N?C?me:ve:C?de:le;w[A]>x[A]&&(D=Ze(D));var R=Ze(D),I=[];if(i&&I.push(j[T]<=0),a&&I.push(j[D]<=0,j[R]<=0),I.every((function(t){return t}))){O=M,S=!1;break}k.set(M,I)}if(S)for(var z=function(t){var e=b.find((function(e){var n=k.get(e);if(n)return n.slice(0,t).every((function(t){return t}))}));if(e)return O=e,"break"},P=d?3:1;P>0;P--){if("break"===z(P))break}e.placement!==O&&(e.modifiersData[r]._skip=!0,e.placement=O,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name,o=n.mainAxis,i=void 0===o||o,s=n.altAxis,a=void 0!==s&&s,p=n.boundary,c=n.rootBoundary,u=n.altBoundary,f=n.padding,h=n.tether,l=void 0===h||h,d=n.tetherOffset,m=void 0===d?0:d,v=ln(e,{boundary:p,rootBoundary:c,padding:f,altBoundary:u}),y=De(e.placement),g=fn(e.placement),b=!g,w=Je(y),x="x"===w?"y":"x",k=e.modifiersData.popperOffsets,S=e.rects.reference,O=e.rects.popper,E="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,M={x:0,y:0};if(k){if(i||a){var T="y"===w?le:ve,C="y"===w?de:me,N="y"===w?"height":"width",A=k[w],j=k[w]+v[T],D=k[w]-v[C],R=l?-O[N]/2:0,I=g===be?S[N]:O[N],z=g===be?-O[N]:-S[N],P=e.elements.arrow,F=l&&P?Ie(P):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},L=B[T],_=B[C],$=He(0,S[N],F[N]),J=b?S[N]/2-R-$-L-E:I-$-L-E,q=b?-S[N]/2+R+$+_+E:z+$+_+E,V=e.elements.arrow&&$e(e.elements.arrow),W=V?"y"===w?V.clientTop||0:V.clientLeft||0:0,H=e.modifiersData.offset?e.modifiersData.offset[e.placement][w]:0,U=k[w]+J-H-W,G=k[w]+q-H;if(i){var K=He(l?Ve(j,U):j,A,l?qe(D,G):D);k[w]=K,M[w]=K-A}if(a){var Y="x"===w?le:ve,X="x"===w?de:me,Q=k[x],Z=Q+v[Y],tt=Q-v[X],et=He(l?Ve(Z,U):Z,Q,l?qe(tt,G):tt);k[x]=et,M[x]=et-Q}}e.modifiersData[r]=M}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,n=t.state,r=t.name,o=t.options,i=n.elements.arrow,s=n.modifiersData.popperOffsets,a=De(n.placement),p=Je(a),c=[ve,me].indexOf(a)>=0?"height":"width";if(i&&s){var u=function(t,e){return Ue("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:Ge(t,ge))}(o.padding,n),f=Ie(i),h="y"===p?le:ve,l="y"===p?de:me,d=n.rects.reference[c]+n.rects.reference[p]-s[p]-n.rects.popper[c],m=s[p]-n.rects.reference[p],v=$e(i),y=v?"y"===p?v.clientHeight||0:v.clientWidth||0:0,g=d/2-m/2,b=u[h],w=y-f[c]-u[l],x=y/2-f[c]/2+g,k=He(b,x,w),S=p;n.modifiersData[r]=((e={})[S]=k,e.centerOffset=k-x,e)}},effect:function(t){var e=t.state,n=t.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=e.elements.popper.querySelector(r)))&&("production"!==process.env.NODE_ENV&&(Ne(r)||console.error(['Popper: "arrow" element must be an HTMLElement (not an SVGElement).',"To use an SVG arrow, wrap it in an HTMLElement that will be used as","the arrow."].join(" "))),ze(e.elements.popper,r)?e.elements.arrow=r:"production"!==process.env.NODE_ENV&&console.error(['Popper: "arrow" modifier\'s `element` must be a child of the popper',"element."].join(" ")))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,n=t.name,r=e.rects.reference,o=e.rects.popper,i=e.modifiersData.preventOverflow,s=ln(e,{elementContext:"reference"}),a=ln(e,{altBoundary:!0}),p=mn(s,r),c=mn(a,o,i),u=vn(p),f=vn(c);e.modifiersData[n]={referenceClippingOffsets:p,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:f},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":f})}}]}),Tn="tippy-content",Cn="tippy-arrow",Nn="tippy-svg-arrow",An={passive:!0,capture:!0};function jn(t,e,n){if(Array.isArray(t)){var r=t[e];return null==r?Array.isArray(n)?n[e]:n:r}return t}function Dn(t,e){var n={}.toString.call(t);return 0===n.indexOf("[object")&&n.indexOf(e+"]")>-1}function Rn(t,e){return"function"==typeof t?t.apply(void 0,e):t}function In(t,e){return 0===e?t:function(r){clearTimeout(n),n=setTimeout((function(){t(r)}),e)};var n}function zn(t){return[].concat(t)}function Pn(t,e){-1===t.indexOf(e)&&t.push(e)}function Fn(t){return[].slice.call(t)}function Bn(){return document.createElement("div")}function Ln(t){return["Element","Fragment"].some((function(e){return Dn(t,e)}))}function _n(t){return Ln(t)?[t]:function(t){return Dn(t,"NodeList")}(t)?Fn(t):Array.isArray(t)?t:Fn(document.querySelectorAll(t))}function $n(t,e){t.forEach((function(t){t&&(t.style.transitionDuration=e+"ms")}))}function Jn(t,e){t.forEach((function(t){t&&t.setAttribute("data-state",e)}))}function qn(t,e,n){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(e){t[r](e,n)}))}var Vn={isTouch:!1},Wn=0;function Hn(){Vn.isTouch||(Vn.isTouch=!0,window.performance&&document.addEventListener("mousemove",Un))}function Un(){var t=performance.now();t-Wn<20&&(Vn.isTouch=!1,document.removeEventListener("mousemove",Un)),Wn=t}function Gn(){var t,e=document.activeElement;if((t=e)&&t._tippy&&t._tippy.reference===t){var n=e._tippy;e.blur&&!n.state.isVisible&&e.blur()}}var Kn,Yn="undefined"!=typeof window&&"undefined"!=typeof document?navigator.userAgent:"",Xn=/MSIE |Trident\//.test(Yn);function Qn(t){return[t+"() was called on a"+("destroy"===t?"n already-":" ")+"destroyed instance. This is a no-op but","indicates a potential memory leak."].join(" ")}function Zn(t){return t.replace(/[ \t]{2,}/g," ").replace(/^[ \t]*/gm,"").trim()}function tr(t){return Zn("\n  %ctippy.js\n\n  %c"+Zn(t)+"\n\n  %c👷‍ This is a development-only message. It will be removed in production.\n  ")}function er(t){return[tr(t),"color: #00C584; font-size: 1.3em; font-weight: bold;","line-height: 1.5","color: #a6a095;"]}function nr(t,e){var n;t&&!Kn.has(e)&&(Kn.add(e),(n=console).warn.apply(n,er(e)))}function rr(t,e){var n;t&&!Kn.has(e)&&(Kn.add(e),(n=console).error.apply(n,er(e)))}"production"!==process.env.NODE_ENV&&(Kn=new Set);var or={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ir=Object.assign({appendTo:function(){return document.body},aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},or,{},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),sr=Object.keys(ir);function ar(t){var e=(t.plugins||[]).reduce((function(e,n){var r=n.name,o=n.defaultValue;return r&&(e[r]=void 0!==t[r]?t[r]:o),e}),{});return Object.assign({},t,{},e)}function pr(t,e){var n=Object.assign({},e,{content:Rn(e.content,[t])},e.ignoreAttributes?{}:function(t,e){return(e?Object.keys(ar(Object.assign({},ir,{plugins:e}))):sr).reduce((function(e,n){var r=(t.getAttribute("data-tippy-"+n)||"").trim();if(!r)return e;if("content"===n)e[n]=r;else try{e[n]=JSON.parse(r)}catch(t){e[n]=r}return e}),{})}(t,e.plugins));return n.aria=Object.assign({},ir.aria,{},n.aria),n.aria={expanded:"auto"===n.aria.expanded?e.interactive:n.aria.expanded,content:"auto"===n.aria.content?e.interactive?null:"describedby":n.aria.content},n}function cr(t,e){void 0===t&&(t={}),void 0===e&&(e=[]),Object.keys(t).forEach((function(t){var n,r,o=function(t,e){var n=Object.assign({},t);return e.forEach((function(t){delete n[t]})),n}(ir,Object.keys(or)),i=(n=o,r=t,!{}.hasOwnProperty.call(n,r));i&&(i=0===e.filter((function(e){return e.name===t})).length),nr(i,["`"+t+"`","is not a valid prop. You may have spelled it incorrectly, or if it's","a plugin, forgot to pass it in an array as props.plugins.","\n\n","All props: https://atomiks.github.io/tippyjs/v6/all-props/\n","Plugins: https://atomiks.github.io/tippyjs/v6/plugins/"].join(" "))}))}function ur(t,e){t.innerHTML=e}function fr(t){var e=Bn();return!0===t?e.className=Cn:(e.className=Nn,Ln(t)?e.appendChild(t):ur(e,t)),e}function hr(t,e){Ln(e.content)?(ur(t,""),t.appendChild(e.content)):"function"!=typeof e.content&&(e.allowHTML?ur(t,e.content):t.textContent=e.content)}function lr(t){var e=t.firstElementChild,n=Fn(e.children);return{box:e,content:n.find((function(t){return t.classList.contains(Tn)})),arrow:n.find((function(t){return t.classList.contains(Cn)||t.classList.contains(Nn)})),backdrop:n.find((function(t){return t.classList.contains("tippy-backdrop")}))}}function dr(t){var e=Bn(),n=Bn();n.className="tippy-box",n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=Bn();function o(n,r){var o=lr(e),i=o.box,s=o.content,a=o.arrow;r.theme?i.setAttribute("data-theme",r.theme):i.removeAttribute("data-theme"),"string"==typeof r.animation?i.setAttribute("data-animation",r.animation):i.removeAttribute("data-animation"),r.inertia?i.setAttribute("data-inertia",""):i.removeAttribute("data-inertia"),i.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?i.setAttribute("role",r.role):i.removeAttribute("role"),n.content===r.content&&n.allowHTML===r.allowHTML||hr(s,t.props),r.arrow?a?n.arrow!==r.arrow&&(i.removeChild(a),i.appendChild(fr(r.arrow))):i.appendChild(fr(r.arrow)):a&&i.removeChild(a)}return r.className=Tn,r.setAttribute("data-state","hidden"),hr(r,t.props),e.appendChild(n),n.appendChild(r),o(t.props,t.props),{popper:e,onUpdate:o}}dr.$$tippy=!0;var mr=1,vr=[],yr=[];function gr(t,e){var n,r,o,i,s,a,p,c,u,f=pr(t,Object.assign({},ir,{},ar((n=e,Object.keys(n).reduce((function(t,e){return void 0!==n[e]&&(t[e]=n[e]),t}),{}))))),h=!1,l=!1,d=!1,m=!1,v=[],y=In(G,f.interactiveDebounce),g=mr++,b=(u=f.plugins).filter((function(t,e){return u.indexOf(t)===e})),w={id:g,reference:t,popper:Bn(),popperInstance:null,props:f,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:b,clearDelayTimeouts:function(){clearTimeout(r),clearTimeout(o),cancelAnimationFrame(i)},setProps:function(e){"production"!==process.env.NODE_ENV&&nr(w.state.isDestroyed,Qn("setProps"));if(w.state.isDestroyed)return;I("onBeforeUpdate",[w,e]),H();var n=w.props,r=pr(t,Object.assign({},w.props,{},e,{ignoreAttributes:!0}));w.props=r,W(),n.interactiveDebounce!==r.interactiveDebounce&&(F(),y=In(G,r.interactiveDebounce));n.triggerTarget&&!r.triggerTarget?zn(n.triggerTarget).forEach((function(t){t.removeAttribute("aria-expanded")})):r.triggerTarget&&t.removeAttribute("aria-expanded");P(),R(),S&&S(n,r);w.popperInstance&&(Q(),tt().forEach((function(t){requestAnimationFrame(t._tippy.popperInstance.forceUpdate)})));I("onAfterUpdate",[w,e])},setContent:function(t){w.setProps({content:t})},show:function(){"production"!==process.env.NODE_ENV&&nr(w.state.isDestroyed,Qn("show"));var t=w.state.isVisible,e=w.state.isDestroyed,n=!w.state.isEnabled,r=Vn.isTouch&&!w.props.touch,o=jn(w.props.duration,0,ir.duration);if(t||e||n||r)return;if(N().hasAttribute("disabled"))return;if(I("onShow",[w],!1),!1===w.props.onShow(w))return;w.state.isVisible=!0,C()&&(k.style.visibility="visible");R(),$(),w.state.isMounted||(k.style.transition="none");if(C()){var i=j(),s=i.box,a=i.content;$n([s,a],0)}p=function(){var t;if(w.state.isVisible&&!m){if(m=!0,k.offsetHeight,k.style.transition=w.props.moveTransition,C()&&w.props.animation){var e=j(),n=e.box,r=e.content;$n([n,r],o),Jn([n,r],"visible")}z(),P(),Pn(yr,w),null==(t=w.popperInstance)||t.forceUpdate(),w.state.isMounted=!0,I("onMount",[w]),w.props.animation&&C()&&function(t,e){q(t,e)}(o,(function(){w.state.isShown=!0,I("onShown",[w])}))}},function(){var t,e=w.props.appendTo,n=N();t=w.props.interactive&&e===ir.appendTo||"parent"===e?n.parentNode:Rn(e,[n]);t.contains(k)||t.appendChild(k);Q(),"production"!==process.env.NODE_ENV&&nr(w.props.interactive&&e===ir.appendTo&&n.nextElementSibling!==k,["Interactive tippy element may not be accessible via keyboard","navigation because it is not directly after the reference element","in the DOM source order.","\n\n","Using a wrapper <div> or <span> tag around the reference element","solves this by creating a new parentNode context.","\n\n","Specifying `appendTo: document.body` silences this warning, but it","assumes you are using a focus management solution to handle","keyboard navigation.","\n\n","See: https://atomiks.github.io/tippyjs/v6/accessibility/#interactivity"].join(" "))}()},hide:function(){"production"!==process.env.NODE_ENV&&nr(w.state.isDestroyed,Qn("hide"));var t=!w.state.isVisible,e=w.state.isDestroyed,n=!w.state.isEnabled,r=jn(w.props.duration,1,ir.duration);if(t||e||n)return;if(I("onHide",[w],!1),!1===w.props.onHide(w))return;w.state.isVisible=!1,w.state.isShown=!1,m=!1,h=!1,C()&&(k.style.visibility="hidden");if(F(),J(),R(),C()){var o=j(),i=o.box,s=o.content;w.props.animation&&($n([i,s],r),Jn([i,s],"hidden"))}z(),P(),w.props.animation?C()&&function(t,e){q(t,(function(){!w.state.isVisible&&k.parentNode&&k.parentNode.contains(k)&&e()}))}(r,w.unmount):w.unmount()},hideWithInteractivity:function(t){"production"!==process.env.NODE_ENV&&nr(w.state.isDestroyed,Qn("hideWithInteractivity"));A().addEventListener("mousemove",y),Pn(vr,y),y(t)},enable:function(){w.state.isEnabled=!0},disable:function(){w.hide(),w.state.isEnabled=!1},unmount:function(){"production"!==process.env.NODE_ENV&&nr(w.state.isDestroyed,Qn("unmount"));w.state.isVisible&&w.hide();if(!w.state.isMounted)return;Z(),tt().forEach((function(t){t._tippy.unmount()})),k.parentNode&&k.parentNode.removeChild(k);yr=yr.filter((function(t){return t!==w})),w.state.isMounted=!1,I("onHidden",[w])},destroy:function(){"production"!==process.env.NODE_ENV&&nr(w.state.isDestroyed,Qn("destroy"));if(w.state.isDestroyed)return;w.clearDelayTimeouts(),w.unmount(),H(),delete t._tippy,w.state.isDestroyed=!0,I("onDestroy",[w])}};if(!f.render)return"production"!==process.env.NODE_ENV&&rr(!0,"render() function has not been supplied."),w;var x=f.render(w),k=x.popper,S=x.onUpdate;k.setAttribute("data-tippy-root",""),k.id="tippy-"+w.id,w.popper=k,t._tippy=w,k._tippy=w;var O=b.map((function(t){return t.fn(w)})),E=t.hasAttribute("aria-expanded");return W(),P(),R(),I("onCreate",[w]),f.showOnCreate&&et(),k.addEventListener("mouseenter",(function(){w.props.interactive&&w.state.isVisible&&w.clearDelayTimeouts()})),k.addEventListener("mouseleave",(function(t){w.props.interactive&&w.props.trigger.indexOf("mouseenter")>=0&&(A().addEventListener("mousemove",y),y(t))})),w;function M(){var t=w.props.touch;return Array.isArray(t)?t:[t,0]}function T(){return"hold"===M()[0]}function C(){var t;return!!(null==(t=w.props.render)?void 0:t.$$tippy)}function N(){return c||t}function A(){var t,e,n=N().parentNode;return n?(null==(e=zn(n)[0])||null==(t=e.ownerDocument)?void 0:t.body)?e.ownerDocument:document:document}function j(){return lr(k)}function D(t){return w.state.isMounted&&!w.state.isVisible||Vn.isTouch||s&&"focus"===s.type?0:jn(w.props.delay,t?0:1,ir.delay)}function R(){k.style.pointerEvents=w.props.interactive&&w.state.isVisible?"":"none",k.style.zIndex=""+w.props.zIndex}function I(t,e,n){var r;(void 0===n&&(n=!0),O.forEach((function(n){n[t]&&n[t].apply(void 0,e)})),n)&&(r=w.props)[t].apply(r,e)}function z(){var e=w.props.aria;if(e.content){var n="aria-"+e.content,r=k.id;zn(w.props.triggerTarget||t).forEach((function(t){var e=t.getAttribute(n);if(w.state.isVisible)t.setAttribute(n,e?e+" "+r:r);else{var o=e&&e.replace(r,"").trim();o?t.setAttribute(n,o):t.removeAttribute(n)}}))}}function P(){!E&&w.props.aria.expanded&&zn(w.props.triggerTarget||t).forEach((function(t){w.props.interactive?t.setAttribute("aria-expanded",w.state.isVisible&&t===N()?"true":"false"):t.removeAttribute("aria-expanded")}))}function F(){A().removeEventListener("mousemove",y),vr=vr.filter((function(t){return t!==y}))}function B(t){if(!(Vn.isTouch&&(d||"mousedown"===t.type)||w.props.interactive&&k.contains(t.target))){if(N().contains(t.target)){if(Vn.isTouch)return;if(w.state.isVisible&&w.props.trigger.indexOf("click")>=0)return}else I("onClickOutside",[w,t]);!0===w.props.hideOnClick&&(w.clearDelayTimeouts(),w.hide(),l=!0,setTimeout((function(){l=!1})),w.state.isMounted||J())}}function L(){d=!0}function _(){d=!1}function $(){var t=A();t.addEventListener("mousedown",B,!0),t.addEventListener("touchend",B,An),t.addEventListener("touchstart",_,An),t.addEventListener("touchmove",L,An)}function J(){var t=A();t.removeEventListener("mousedown",B,!0),t.removeEventListener("touchend",B,An),t.removeEventListener("touchstart",_,An),t.removeEventListener("touchmove",L,An)}function q(t,e){var n=j().box;function r(t){t.target===n&&(qn(n,"remove",r),e())}if(0===t)return e();qn(n,"remove",a),qn(n,"add",r),a=r}function V(e,n,r){void 0===r&&(r=!1),zn(w.props.triggerTarget||t).forEach((function(t){t.addEventListener(e,n,r),v.push({node:t,eventType:e,handler:n,options:r})}))}function W(){var t;T()&&(V("touchstart",U,{passive:!0}),V("touchend",K,{passive:!0})),(t=w.props.trigger,t.split(/\s+/).filter(Boolean)).forEach((function(t){if("manual"!==t)switch(V(t,U),t){case"mouseenter":V("mouseleave",K);break;case"focus":V(Xn?"focusout":"blur",Y);break;case"focusin":V("focusout",Y)}}))}function H(){v.forEach((function(t){var e=t.node,n=t.eventType,r=t.handler,o=t.options;e.removeEventListener(n,r,o)})),v=[]}function U(t){var e,n=!1;if(w.state.isEnabled&&!X(t)&&!l){var r="focus"===(null==(e=s)?void 0:e.type);s=t,c=t.currentTarget,P(),!w.state.isVisible&&Dn(t,"MouseEvent")&&vr.forEach((function(e){return e(t)})),"click"===t.type&&(w.props.trigger.indexOf("mouseenter")<0||h)&&!1!==w.props.hideOnClick&&w.state.isVisible?n=!0:et(t),"click"===t.type&&(h=!n),n&&!r&&nt(t)}}function G(t){var e=t.target,n=N().contains(e)||k.contains(e);"mousemove"===t.type&&n||function(t,e){var n=e.clientX,r=e.clientY;return t.every((function(t){var e=t.popperRect,o=t.popperState,i=t.props.interactiveBorder,s=o.placement.split("-")[0],a=o.modifiersData.offset;if(!a)return!0;var p="bottom"===s?a.top.y:0,c="top"===s?a.bottom.y:0,u="right"===s?a.left.x:0,f="left"===s?a.right.x:0,h=e.top-r+p>i,l=r-e.bottom-c>i,d=e.left-n+u>i,m=n-e.right-f>i;return h||l||d||m}))}(tt().concat(k).map((function(t){var e,n=null==(e=t._tippy.popperInstance)?void 0:e.state;return n?{popperRect:t.getBoundingClientRect(),popperState:n,props:f}:null})).filter(Boolean),t)&&(F(),nt(t))}function K(t){X(t)||w.props.trigger.indexOf("click")>=0&&h||(w.props.interactive?w.hideWithInteractivity(t):nt(t))}function Y(t){w.props.trigger.indexOf("focusin")<0&&t.target!==N()||w.props.interactive&&t.relatedTarget&&k.contains(t.relatedTarget)||nt(t)}function X(t){return!!Vn.isTouch&&T()!==t.type.indexOf("touch")>=0}function Q(){Z();var e=w.props,n=e.popperOptions,r=e.placement,o=e.offset,i=e.getReferenceClientRect,s=e.moveTransition,a=C()?lr(k).arrow:null,c=i?{getBoundingClientRect:i,contextElement:i.contextElement||N()}:t,u=[{name:"offset",options:{offset:o}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!s}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(t){var e=t.state;if(C()){var n=j().box;["placement","reference-hidden","escaped"].forEach((function(t){"placement"===t?n.setAttribute("data-placement",e.placement):e.attributes.popper["data-popper-"+t]?n.setAttribute("data-"+t,""):n.removeAttribute("data-"+t)})),e.attributes.popper={}}}}];C()&&a&&u.push({name:"arrow",options:{element:a,padding:3}}),u.push.apply(u,(null==n?void 0:n.modifiers)||[]),w.popperInstance=Mn(c,k,Object.assign({},n,{placement:r,onFirstUpdate:p,modifiers:u}))}function Z(){w.popperInstance&&(w.popperInstance.destroy(),w.popperInstance=null)}function tt(){return Fn(k.querySelectorAll("[data-tippy-root]"))}function et(t){w.clearDelayTimeouts(),t&&I("onTrigger",[w,t]),$();var e=D(!0),n=M(),o=n[0],i=n[1];Vn.isTouch&&"hold"===o&&i&&(e=i),e?r=setTimeout((function(){w.show()}),e):w.show()}function nt(t){if(w.clearDelayTimeouts(),I("onUntrigger",[w,t]),w.state.isVisible){if(!(w.props.trigger.indexOf("mouseenter")>=0&&w.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(t.type)>=0&&h)){var e=D(!1);e?o=setTimeout((function(){w.state.isVisible&&w.hide()}),e):i=requestAnimationFrame((function(){w.hide()}))}}else J()}}function br(t,e){void 0===e&&(e={});var n=ir.plugins.concat(e.plugins||[]);"production"!==process.env.NODE_ENV&&(!function(t){var e=!t,n="[object Object]"===Object.prototype.toString.call(t)&&!t.addEventListener;rr(e,["tippy() was passed","`"+String(t)+"`","as its targets (first) argument. Valid types are: String, Element,","Element[], or NodeList."].join(" ")),rr(n,["tippy() was passed a plain object which is not supported as an argument","for virtual positioning. Use props.getReferenceClientRect instead."].join(" "))}(t),cr(e,n)),document.addEventListener("touchstart",Hn,An),window.addEventListener("blur",Gn);var r=Object.assign({},e,{plugins:n}),o=_n(t);if("production"!==process.env.NODE_ENV){var i=Ln(r.content),s=o.length>1;nr(i&&s,["tippy() was passed an Element as the `content` prop, but more than","one tippy instance was created by this invocation. This means the","content element will only be appended to the last tippy instance.","\n\n","Instead, pass the .innerHTML of the element, or use a function that","returns a cloned version of the element instead.","\n\n","1) content: element.innerHTML\n","2) content: () => element.cloneNode(true)"].join(" "))}var a=o.reduce((function(t,e){var n=e&&gr(e,r);return n&&t.push(n),t}),[]);return Ln(t)?a[0]:a}br.defaultProps=ir,br.setDefaultProps=function(t){"production"!==process.env.NODE_ENV&&cr(t,[]),Object.keys(t).forEach((function(e){ir[e]=t[e]}))},br.currentInput=Vn,Object.assign({},je,{effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow)}}),br.setDefaultProps({render:dr});class wr{constructor({editor:t,element:e,view:n,tippyOptions:r}){this.preventHide=!1,this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:t})=>{var e;this.preventHide?this.preventHide=!1:(null==t?void 0:t.relatedTarget)&&(null===(e=this.element.parentNode)||void 0===e?void 0:e.contains(t.relatedTarget))||this.hide()},this.editor=t,this.element=e,this.view=n,this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.createTooltip(r),this.element.style.visibility="visible"}createTooltip(t={}){this.tippy=br(this.view.dom,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...t})}update(t,n){const{state:r,composing:o}=t,{doc:i,selection:s}=r,a=n&&n.doc.eq(i)&&n.selection.eq(s);if(o||a)return;const{from:p,to:c,empty:u,$anchor:f}=s;!u&&f.parent.textContent?(this.tippy.setProps({getReferenceClientRect:()=>e.posToDOMRect(t,p,c)}),this.show()):this.hide()}show(){this.tippy.show()}hide(){this.tippy.hide()}destroy(){this.tippy.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const xr=new he("menuBubble"),kr=t=>new ce({key:xr,view:e=>new wr({view:e,...t})}),Sr=e.Extension.create({name:"bubbleMenu",defaultOptions:{element:null,tippyOptions:{}},addProseMirrorPlugins(){return this.options.element?[kr({editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions})]:[]}});t.BubbleMenu=Sr,t.BubbleMenuPlugin=kr,t.BubbleMenuPluginKey=xr,t.BubbleMenuView=wr,t.default=Sr,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=tiptap-extension-bubble-menu.bundle.umd.min.js.map
